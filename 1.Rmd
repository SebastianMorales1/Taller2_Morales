---
title: "Taller 2 y 3 de fundamentos de programación."
output: html_notebook.
author: Sebastián Morales.
---

1. Cree un repositorio de Github que se llame Taller2_Apellido. Use su primer apellido en reemplazo de la palabra Apellido en el nombre. Este repositorio debe ser privado.Después de crearlo, cree un proyecto en RStudio y vincúlelo al repositorio que creó.

2. Dentro de este proyecto, cree un notebook en el que va a desarrollar el taller.

3. Use la siguiente función para descargar de la API del Banco Mundial la información
de los indicadores NY.ADJ.NNTY.PC.KD, que contiene el ingreso nacional percapita
neto ajustado, y SP.DYN.LE00.IN que contiene la expectativa de vida al nacer para
ambos sexos.

Librerías varias
```{r}
library(tidyverse)
library(lubridate)
library(haven)
library(readxl)
library(knitr)
```
Limpiar espacio de trabajo
```{r}
rm(list = ls())
```


```{r}
#install.packages("utf8")
#install.packages("wbstats")
#library(wbstats)
datos_bm <- wb_data(indicator = c("NY.ADJ.NNTY.PC.KD", "SP.DYN.LE00.IN"), start_date = 2000, end_date = 2020, return_wide = FALSE)
#View(datos_bm)
head(datos_bm)
```

4. Use la siguiente función para descargar la tabla de información disponible para los
países:

```{r}
paises_bm <- wb_countries()
#View(paises_bm)
head(paises_bm)
```

5. En la base países_bm seleccione las siguientes variables:iso3c, region, income_level.

```{r}
paises_bm1 <- paises_bm %>%
  select(iso3c, region, income_level) 
#View(paises_bm1)
head(paises_bm1)
```

6. Una las bases de datos datos_bm y países_bm.
```{r}
# limpiar dataset "datos_bm"

union_bm <- left_join(paises_bm1,datos_bm,by = "iso3c")
#onion_bm <- left_join(datos_bm,paises_bm1,by = "iso3c")
head(union_bm)
#View(union_bm)

#elijo union_bm
```

7. En la variable indicator_id cambie los valores NY.ADJ.NNTY.PC.KD y SP.DYN.LE00.IN por ing_nac_ajustado y expectativa_vida, respectivamente.

```{r}
union_bm1 <- union_bm %>% mutate(indicador_id = recode(indicator_id, NY.ADJ.NNTY.PC.KD = "ing_nac_ajustado", SP.DYN.LE00.IN = "expectativa_vida"))
head(union_bm1)
#View(union_bm)
```


```{r}
#ESTO ES INEFICIENTE
union_bm$indicator_id[union_bm$indicator_id == "NY.ADJ.NNTY.PC.KD"] <- "ing_nac_ajustado"
union_bm$indicator_id[union_bm$indicator_id == "SP.DYN.LE00.IN"] <- "expectativa_vida"
head(union_bm)
#View(union_bm)
```

```{r}
#NO SE PORQUE NO FUNCIONA
union_bm %>%
  mutate(indicator_id = replace(indicator_id, indicator_id == "NY.ADJ.NNTY.PC.KD", "ing_nac_ajustado")) %>%
  mutate(indicator_id = replace(indicator_id, indicator_id == "SP.DYN.LE00.IN", "expectativa_vida"))
View(union_bm)
#NO SE PORQUE NO FUNCIONA
```

```{r}
#OTRA COSA
mtcars$mpg[mtcars$cyl == 4] <- NA


mtcars %>%
     mutate(mpg=replace(mpg, cyl==4, NA)) %>%
     as.data.frame()
```

8. Use la función pivot_wider para transformar la base de datos de manera que se consideren datos limpios (i.e. tidy data). En la base resultante deben haber 8 variables: indicator_id, indicator, iso2c, iso3c, country, date, region, income_level, ing_nac_ajustado y expectativa_vida. Antes de correr la función revise para qué sirve y cómo se usa el argumento id_cols dentro de esta función.

```{r}
pivot_wider()
?pivot_wider
??id_cols
```

```{r}
View(union_bm1)
bm_ancha <- pivot_wider(union_bm1,
                   names_from = "indicador_id", 
                   values_from =  value)
head(bm_ancha)
View(bm_ancha)
bm_ancha1 <- bm_ancha %>%
  select(indicator_id, indicator, iso2c, iso3c, country, date, region, income_level, ing_nac_ajustado, expectativa_vida) 
head(bm_ancha1)
View(bm_ancha1)
```

9. Reorganice las variables para que aparezcan las siguientes al comienzo de la base de datos: region, income_level, country, date, ing_nac_ajustado y expectativa_vida.
```{r}
bm_ancha2 <- bm_ancha1 %>%
  select(region, income_level, country, date, ing_nac_ajustado, expectativa_vida, indicator_id, indicator, iso2c, iso3c)
head(bm_ancha2)
```

10. Usando la base anterior, cree una base de datos que solamente contenga las variables country, date, region, income_level, ing_nac_ajustado y expectativa_vida. Esta base debe llamarse bm_principales. Use alguna función del paquete naniar para explorar los valores faltantes en esta base. ¿Cuál variable parece tener mayor número de valores faltantes?
```{r}
bm_principales <- bm_ancha2 %>%
  select(country, date, region, income_level, ing_nac_ajustado, expectativa_vida)
head(bm_principales)
#View(bm_principales)
```

```{r}
install.packages("naniar")
library(naniar)
?naniar
vis_miss(bm_principales)
gg_miss_var(bm_principales)
```
Comentario
La variable con mayor numero de datos faltantes es ing_nac_ajustado.

11. Use la función gg_miss_fct para mostrar el comportamiento de los valores faltantes en esta base de datos, de acuerdo con las categorías de la variable region. ¿En cuál región parecen haber más valores faltantes para las variables expectativa_vida e ing_nac_ajustado? Repita el ejercicio pero ahora usando la variable income_level. ¿En cuál nivel de ingreso parecen haber más valores faltantes para las variables mencionadas.

```{r}
gg_miss_fct(bm_principales, region)
gg_miss_fct(bm_principales, income_level)
```
Comentario:
- En la región de Asia Oriental y el Pacífico parece tener más datos faltantes de la variable "ing_nac_ajustado". Igualmente, las regiones de Asia oriental y el Pacífico y Latinomérica y el Caribe parecen tener más datos faltantos que el resto de regiones en la variable "expectativa_vida".

- El nivel de ingreso alto parece tener más datos faltantes con respecto al resto de niveles de ingreso, tanto para la variable "ing_nac_ajustado" como para la variable "expectativa_vida".

12. Filtre el año 2015 y realice un diagrama de dispersión de las variables expectativa_vida (eje y) e ing_nac_ajustado (eje x) para ese año. El color de los puntos debe depender de la variable region. ¿Qué muestra la gráfica sobre la relación entre las variables para el 2015?

```{r}

```

